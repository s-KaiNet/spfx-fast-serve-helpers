import webpack from 'webpack';
import del from 'del';
import { ClearCssModulesPluginOptions } from '../common/types';

///
// Removes *.module.scss.ts on the first execution in order prevent conflicts with *.module.scss.d.ts
// generated by css-modules-typescript-loader
///
export class ClearCssModuleDefinitionsPlugin {
  constructor(private options: ClearCssModulesPluginOptions) {
  }

  apply(compiler: webpack.Compiler) {
    compiler.hooks.done.tap('FixStylesPlugin', () => {
      if (!this.options.deleted) {

        setTimeout(() => {
          del.sync(['src/**/*.module.scss.ts'], { cwd: this.options.rootFolder });
        }, 3000);

        this.options.deleted = true;
      }
    });
  }
}